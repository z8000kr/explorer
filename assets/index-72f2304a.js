import{d as G,J as K,l as O,Y as Q,i as n,k as W,ac as X,j as M,ad as P,o as c,m as r,n as s,w as Z,v as ss,p as i,a4 as ts,F as k,q as $,t as e,I as S,M as z,ae as es}from"./index-f08f96fe.js";import{b as A}from"./route-block-83d24a4e.js";const os={class:"bg-base-100 px-4 pt-3 pb-4 rounded shadow"},as={class:"form-control"},ns={class:"input-group input-group-md w-full flex"},ls={key:0,class:"text-error mt-1"},ds={key:0,class:"mt-4"},is={class:"grid grid-cols-1 md:!grid-cols-4 auto-cols-auto gap-4 pb-4"},cs={class:"bg-base-100 px-4 py-3 rounded shadow flex justify-between items-center"},rs={class:"text-sm mb-1 flex flex-col truncate"},us={class:"text-lg font-semibold text-main"},_s={class:"text-md"},hs={class:"avatar placeholder"},ps={class:"bg-rose-100 text-neutral-content rounded-full w-12 h-12"},vs={class:"text-2xl text-error font-semibold"},xs={class:"bg-base-100 px-4 py-3 rounded shadow flex justify-between items-center"},fs={class:"text-sm mb-1 flex flex-col truncate"},ms={class:"text-lg font-semibold text-main"},bs={class:"text-md"},gs={class:"avatar placeholder"},ws={class:"bg-green-100 text-neutral-content rounded-full w-12 h-12"},ys={class:"text-2xl text-success font-semibold"},ks={class:"bg-base-100 px-4 py-3 rounded shadow flex justify-between items-center"},$s={class:"text-sm mb-1 flex flex-col truncate"},Ss={class:"text-lg font-semibold text-main"},Cs={class:"text-md"},js={class:"avatar placeholder"},Ts={class:"bg-violet-100 text-neutral-content rounded-full w-12 h-12"},Ds={class:"text-2xl text-primary font-semibold"},Ls={class:"bg-base-100 px-4 py-3 rounded shadow flex justify-between items-center"},Vs={class:"text-sm mb-1 flex flex-col truncate"},Bs={class:"text-lg font-semibold text-main"},Es={class:"text-md"},Fs={class:"avatar placeholder"},Is={class:"bg-blue-100 text-neutral-content rounded-full w-12 h-12"},Ns={class:"text-2xl text-info font-semibold"},Ms={key:1,class:"bg-base-100 p-4 rounded shadow"},Ps={class:"flex flex-1 flex-col truncate"},zs={class:"text-sm card-title text-error mb-6"},As={class:"text-xs mb-1"},Hs={class:"text-xs break-words"},Us={class:"flex flex-rows flex-wrap py-6"},qs={class:"flex flex-rows justify-between"},Js={class:"truncate"},Rs=["data-tip"],Ys=["data-tip"],Gs=s("div",{class:"divider"},null,-1),Ks={class:"text-[#00cfe8] bg-[rgba(0,207,232,0.12)] rounded shadow mt-4 alert-info"},Os={class:"drop-shadow-md px-4 pt-2 pb-2",style:{"box-shadow":"rgba(0, 207, 232, 0.4) 0px 6px 15px -7px"}},Qs={class:"text-base font-semibold"},Ws={class:"px-4 py-4"},Xs={style:{"list-style-type":"disc"},class:"pl-8"},Zs=G({__name:"index",setup(st){var F,I;const H=K(),U=O(),C=Q(),j=n(((I=(F=U.current)==null?void 0:F.endpoints)==null?void 0:I.rpc)||[{address:"",provider:""}]);let h=n("");n(C.validators);let _=n(200),p=n(""),u=n({}),g=n(""),T=n(""),D=n(""),L=n(""),f=null,V=n(new Date),w=n([]),B=n([]);W(async()=>{B.value=await C.fetchAcitveValdiators(),h.value=j.value[0].address+"/consensus_state",await E(),m(),y(),f=setInterval(()=>{m()},6e3)}),X(()=>{y()});function y(){clearInterval(f),f=null}const q=M(()=>H.toDay(V.value,"time")),J=M(()=>B.value.map(t=>{const o=t;return o.hex=es(t.consensus_pubkey),o}));function R(t,o){var a,l,d;if(o==="nil-Vote"){if((l=(a=w.value)==null?void 0:a[t])!=null&&l.address){const v=J.value.find(b=>{var x,N;return b.hex===((N=(x=w.value)==null?void 0:x[t])==null?void 0:N.address)});return((d=v==null?void 0:v.description)==null?void 0:d.moniker)||t}return t}}async function Y(){_.value=200,p.value="",u.value={},y(),await E(),m(),f=setInterval(()=>{m()},6e3)}async function E(){let t=h.value.replace("consensus_state","dump_consensus_state");try{const o=await P(t);if(!o.ok)throw new Error(`HTTP error: ${o.status}`);_.value=o.status,p.value=o.statusText;const a=await o.json();w.value=a.result.round_state.validators.validators}catch(o){_.value=(o==null?void 0:o.status)||500,p.value=(o==null?void 0:o.message)||"Error"}}async function m(){g.value="0%",V.value=new Date,_.value===200&&P(h.value).then(t=>(_.value=t.status,p.value=t.statusText,t.json())).then(t=>{var a,l,d,v;u.value=t.result.round_state;const o=(l=(a=u==null?void 0:u.value)==null?void 0:a["height/round/step"])==null?void 0:l.split("/");T.value=o[0],D.value=o[1],L.value=o[2],(v=(d=u.value)==null?void 0:d.height_vote_set)==null||v.forEach(b=>{const x=Number(b.prevotes_bit_array.substring(b.prevotes_bit_array.length-4));x>0&&(g.value=`${(x*100).toFixed()}%`)})}).catch(t=>{_.value=500,p.value=t})}return(t,o)=>(c(),r("div",null,[s("div",os,[s("div",as,[s("label",ns,[Z(s("select",{"onUpdate:modelValue":o[0]||(o[0]=a=>ts(h)?h.value=a:h=a),class:"select select-bordered w-full flex-1"},[(c(!0),r(k,null,$(j.value,(a,l)=>(c(),r("option",{key:l},e(a==null?void 0:a.address)+"/consensus_state ",1))),128))],512),[[ss,i(h)]]),s("button",{class:"btn btn-primary",onClick:Y},e(t.$t("consensus.monitor")),1)])]),i(_)!==200?(c(),r("div",ls,e(i(_))+": "+e(i(p)),1)):S("",!0)]),i(u)["height/round/step"]?(c(),r("div",ds,[s("div",is,[s("div",cs,[s("div",rs,[s("h4",us,e(i(g)),1),s("span",_s,e(t.$t("consensus.onboard_rate")),1)]),s("div",hs,[s("div",ps,[s("span",vs,e(t.$t("consensus.o")),1)])])]),s("div",xs,[s("div",fs,[s("h4",ms,e(i(T)),1),s("span",bs,e(t.$t("account.height")),1)]),s("div",gs,[s("div",ws,[s("span",ys,e(t.$t("consensus.h")),1)])])]),s("div",ks,[s("div",$s,[s("h4",Ss,e(i(D)),1),s("span",Cs,e(t.$t("consensus.round")),1)]),s("div",js,[s("div",Ts,[s("span",Ds,e(t.$t("consensus.r")),1)])])]),s("div",Ls,[s("div",Vs,[s("h4",Bs,e(i(L)),1),s("span",Es,e(t.$t("consensus.step")),1)]),s("div",Fs,[s("div",Is,[s("span",Ns,e(t.$t("consensus.s")),1)])])])])])):S("",!0),i(u)["height/round/step"]?(c(),r("div",Ms,[s("div",Ps,[s("h2",zs,e(t.$t("consensus.updated_at"))+" "+e(q.value||""),1),(c(!0),r(k,null,$(i(u).height_vote_set,a=>(c(),r("div",{key:a.round},[s("div",As,e(t.$t("consensus.round"))+": "+e(a.round),1),s("div",Hs,e(a.prevotes_bit_array),1),s("div",Us,[(c(!0),r(k,null,$(a.prevotes,(l,d)=>(c(),r("div",{class:"w-48 rounded-3xl h-5 text-sm px-2 text-slate-200 leading-5",key:d,size:"sm",style:{margin:"2px"}},[s("span",qs,[s("span",Js,e(R(d,"nil-Vote")),1),s("span",null,[s("span",{class:z(["tooltip",{"bg-green-400":String(l).toLowerCase()!=="nil-vote","bg-red-400":String(l).toLowerCase()==="nil-vote"}]),"data-tip":l}," ",10,Rs),s("span",{class:z(["tooltip ml-1",{"bg-green-400":String(a.precommits[d]).toLowerCase()!=="nil-vote","bg-red-400":String(a.precommits[d]).toLowerCase()==="nil-vote"}]),"data-tip":a.precommits[d]}," ",10,Ys)])])]))),128))])]))),128))]),Gs])):S("",!0),s("div",Ks,[s("div",Os,[s("h2",Qs,e(t.$t("consensus.tips")),1)]),s("div",Ws,[s("ul",Xs,[s("li",null,e(t.$t("consensus.tips_description_1")),1),s("li",null,e(t.$t("consensus.tips_description_2")),1)])])])]))}});typeof A=="function"&&A(Zs);export{Zs as default};
